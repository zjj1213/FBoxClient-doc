# **配置云服务**

### 我们的产品的是 FBox，也叫盒子，网关，在下文中会统一简称盒子。 



**1、在 FlexManager 的“远程下载-->设备管理—>网络 PLC”中创建 MQTT 连接设备，如图设置：**



![配置云服务](images\tupian20.png)  

​       



**在此处添加的设备中，IP 地址和端口是忽略的，在下一步配置云服务中设置 IP 地址（服务地址） 和端口号。**



**2、然后在“远程下载-->设备管理-->云服务”中配置 MQTT 推送的服务器地址、端口号、设备 ID、登录用户名与密码等信息。**



![配置云服务](images\tupian21.png)

**云服务：**繁易 MQTT，指定的 MQTT 服务协议

**Keep alive：**心跳包时间，单位：s

**服务地址：**MQTT 推送的服务器地址

**设备ID：**用于指定盒子的设备 ID（比如盒子序列号，或者用户自定义的 ID）

**加密：**启用加密，支持盒子与 MQTT 服务器使用 TLS（SSL）进行通讯

**离线缓存方式**：允许在 MQTT 离线的状态下，将推送的消息缓存到 SD 卡或 U 盘，如果不需要缓存，选择“无”

**客户端证书：**若启用了 TLS 加密，方可启用客户端证书。该证书为盒子使用

**服务器证书:** 若启用了 TLS 加密，方可启用服务器证书。该证书为 MQTT 服务器所使用的证书。若盒子需要双向加密，可启用该项，否则不需要启用

**主题：**支持自定义主题前缀，若不自定义，则默认使用这个前缀：Topic/flexem/fbox/。

​                 以盒子序列号 222218030009 为例，重启的主题为：Topic/flexem/fbox/222218030009/system/Reboot， 若自定义的前缀为：office/room1/,则重启 

​                 的主题为：office/room1/222218030009/system/Reboot

**注意：**自定义主题必须以“/”结尾，若自定义主题前有/，则订阅主题是也要加上对应的/。 

**用户验证：**是盒子登录 MQTT 服务器所需要的用户信息验证

**同步报警、同步监控点：**若是首次使用 MQTT 服务，添加监控点或报警条目后，需要点击“同步报警”或者“同步监控点”才能使添加的条目推送 MQTT 生效；若不是首次需要点击“同步报警” 或者“同步监控点”后，再重启设备才能使添加的条目推送 MQTT 生效。如果不使用报警，可以不进行同步报警。





### 注意：

**FBox在使用MQTT来推送数据时，需要在报警记录内引用一个mqtt地址的任意一点变量，（例如mqtt-connect）。设置完报警条目之后需要在云服务配置窗口点击同步报警点。如下图所示。**



​     ![](images\tupian22.png)    





**3、验证 MQTT 服务器与客户端是否连通，在数据监控中添加地址类型为“mqtt_connect”的监控点，数值为 1 时，就代表连通，如果值为 0，代表没有连通，需要去检查前两个步骤的配置是否有错误。**



​                                                                                                         ![配置云服务](images\tupian23.png)     

​                                                                                                         ![配置云服务](images\tupian24.png)                                         